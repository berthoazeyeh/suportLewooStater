default_platform(:ios)

platform :ios do
  desc "Build and upload to App Store Connect"
  lane :release do
    # Incrementer le build number
    increment_build_number(
      xcodeproj: "BeaconSender.xcodeproj"
    )
    
    # Synchroniser les certificats
    match(
      type: "appstore",
      readonly: true
    )
    
    # Build de l'app
    build_app(
      scheme: "BeaconSender",
      export_method: "app-store",
      output_directory: "./build",
      output_name: "app.ipa",
      export_options: {
        provisioningProfiles: {
          "com.votreentreprise.votreapp" => "match AppStore com.votreentreprise.votreapp"
        }
      }
    )
    
    # Upload vers App Store Connect
    upload_to_app_store(
      skip_metadata: true,
      skip_screenshots: true,
      ipa: "./build/app.ipa",
      force: true
    )
  end
  
  desc "Build only (for testing)"
  lane :build_only do
    increment_build_number(
      xcodeproj: "BeaconSender.xcodeproj"
    )
    
    match(
      type: "appstore",
      readonly: true
    )
    
    build_app(
      scheme: "BeaconSender",
      export_method: "app-store",
      output_directory: "./build",
      output_name: "app.ipa"
    )
  end
end